<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <title>7 wonders scoreboards</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
  <link rel="stylesheet" href="style.css"  type="text/css" />
</head>

<body>

  <h1>7 wonders scoreboard</h1>

  <table id="Scoreboard">
    <!--Create the start table for 3 players with the id for the player name and score 
      (need for the score calculation and winner announce)-->
    <colgroup>
      <col class="playerName">
      <col class="militaire">
      <col class="coins">
      <col class="wonder">
      <col class="civil">
      <col class="commerce">
      <col class="science">
      <col class="score">
    </colgroup>  
    <tr>
      <th>Nom</th>
      <th>Militaire</th>
      <th>Pièces</th>
      <th>Merveille</th>
      <th>Bleu</th>
      <th>Jaune</th>
      <th>Vert</th>
      <th>Score</th>
    </tr>
    <tr>
      <td><input id="Player1" type="text"></td>
      <td><input class="points" type="number"></td>
      <td><input class="points" type="number"></td>
      <td><input class="points" type="number"></td>
      <td><input class="points" type="number"></td>
      <td><input class="points" type="number"></td>
      <td><input class="points" type="number" onclick="sciencePoints()"></td>
      <td id="Score1"></td>

    </tr>

    <tr>
      <td><input id="Player2" type="text"></td>
      <td><input class="points" type="number"></td>
      <td><input class="points" type="number"></td>
      <td><input class="points" type="number"></td>
      <td><input class="points" type="number"></td>
      <td><input class="points" type="number"></td>
      <td><input class="points" type="number" onclick="sciencePoints()"></td>
      <td id="Score2"></td>

    </tr>

    <tr>
      <td><input id="Player3" type="text"></td>
      <td><input class="points" type="number"></td>
      <td><input class="points" type="number"></td>
      <td><input class="points" type="number"></td>
      <td><input class="points" type="number"></td>
      <td><input class="points" type="number"></td>
      <td><input class="points" type="number" onclick="sciencePoints()"></td>
      <td id="Score3"></td>

    </tr>
  </table>

  <div id="testBouton">
  <button class="bouton" id="CalculScore" onclick="CalculScore">Calcul des scores</button>
  <button class="bouton" id="Winner" onclick="Winner">Vainqueur ?</button>
  <button class="bouton" id="Ajout" onclick="Ajout">Ajouter un joueur</button>
  <button class="bouton" id="Retrait" onclick="Retrait">Supprimer un joueur</button>
  <button class="bouton" id="Test" onclick="Test">Test</button>
  <button class="bouton" id="NewScore" onclick="NewScore">Supprimer les scores</button>
  <button class="bouton" id="NewGame" onclick="NewGame">Nouveau jeu</button>
  </div>

  <div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
      <span class="close">&times;</span>
      <div class="content">
        <label for="wheel">Nombre de cartes "Roue"</label>
        <input id="wheel" name="wheel" type="number">
      </div>
      <div class="content">
        <label for="compass">Nombre de cartes "Compas"</label>
        <input id="compass" name="compass" type="number">
      </div>
      <div class="content">
        <label for="tablet">Nombre de cartes "Tablette"</label>
        <input id="tablet" name="tablet" type="number">
      </div>
      <button id="test" class="content">Test</button>

    </div>
  
  </div>

  <script>
    let numberOfPlayers = 3;
    var clickedInput;
    document.getElementById("CalculScore").addEventListener("click", CalculScore);
    document.getElementById("Winner").addEventListener("click", Winner);
    document.getElementById("Ajout").addEventListener("click", Ajout);
    document.getElementById("Retrait").addEventListener("click", Retrait);
    document.getElementById("NewScore").addEventListener("click", NewScore);
    document.getElementById("NewGame").addEventListener("click", NewGame);
    document.getElementById("Test").onclick = function() {document.getElementById("myModal").style.display = "block";}
   
    

    document.getElementById("test").addEventListener("click", SciencePointsCalc);
    

    let span = document.getElementsByClassName("close")[0];
    span.onclick = function(){document.getElementById("myModal").style.display = "none";}
    


    function CalculScore() {
      let table = document.getElementById("Scoreboard");
      // loop to calc the score
      for (let i = 1; i < numberOfPlayers + 1; i++) { // start a 1 because 0 is columns name, +1 to stop at number of players 
        let currentCell = table.rows.item(i).cells;
        let cellLength = 8;
        let Score = 0;

        for (let j = 1; j < cellLength - 1; j++) {
          // start at 1 because 0 is player name, -1 to stop before the last columns which is for the score
          let cellValue = Number(currentCell[j].firstChild.value);
          if(j == 2){
            Score = Score + Math.floor(cellValue/3)
          }
          else {
            Score = Score + cellValue;
           
          } 
          document.getElementById(`Score${i}`).innerHTML = Score;
        }

      }


    }

    function Winner() {
      let maxValue = 0;
      let winner = "";
      for (let i = 1; i < numberOfPlayers + 1; i++) {
        // the loop will get each score and compare it to the maxValue
        // if > maxValue store the value and the player name then announce the winner and his score
        if (Number(document.getElementById(`Score${i}`).innerHTML) > maxValue) {
          maxValue = document.getElementById(`Score${i}`).innerHTML;
          winner = document.getElementById(`Player${i}`).value;
        }
      }

      alert(`Bravo !! ${winner} a gagné avec un score de ${maxValue} !!`);
    }

    function Ajout() {
      //Add a row for a new player (max 8) with an id for player name and player score (use in CalculScore and Winner)
      if (numberOfPlayers < 8) {
        numberOfPlayers += 1;
        let id1 = `Score${numberOfPlayers}`;
        let id2 = `Player${numberOfPlayers}`;
        document.getElementById("Scoreboard").insertRow(-1).innerHTML = `<tr><td><input id="${id2}" value="Joueur ${numberOfPlayers}" type="text"></td><td ><input class="points" type="number"></td><td ><input class="points" type="number"></td><td><input class="points" type="number"></td><td><input class="points" type="number"></td><td><input class="points" type="number"></td><td><input class="points" onclick="sciencePoints()" type="number"></td><td id="${id1}"></td></tr>`;

      }
    }

    function Retrait() {
      // Delete a player in the scoreboard only if nb of players > 3
      if (numberOfPlayers > 3) {
        let table = document.getElementById("Scoreboard");
        let rowCount = table.rows.length;
        table.deleteRow(rowCount - 1);
        numberOfPlayers -= 1;

      }

    }

    function NewScore() {
      let table = document.getElementById("Scoreboard");
      // loop to delete value in cell
      for (let i = 1; i < numberOfPlayers + 1; i++) { // start a 1 because 0 is columns name, +1 to stop at number of players 
        let currentCell = table.rows.item(i).cells;
        let cellLength = 8;

        for (let j = 1; j < cellLength - 1; j++) {

          currentCell[j].firstChild.value = "";
        }
        document.getElementById(`Score${i}`).innerHTML = "";
      }
    }

    function NewGame() {
      // function to reset the scoreboard
      let table = document.getElementById("Scoreboard");
      let newNumberOfPlayers = 3;
      // loop to delete value in cell for players 1 to 3
      for (let i = 1; i < newNumberOfPlayers + 1; i++) { // start a 1 because 0 is columns name, +1 to stop at number of players 
        let currentCell = table.rows.item(i).cells;
        let cellLength = currentCell.length;

        for (let j = 1; j < cellLength - 1; j++) {

          currentCell[j].firstChild.value = "";
        }
        document.getElementById(`Score${i}`).innerHTML = "";
        document.getElementById(`Player${i}`).value = "";
      }
      // loop to delete row after player 3
      for (numberOfPlayers; numberOfPlayers > newNumberOfPlayers; numberOfPlayers--) {
        table.deleteRow(numberOfPlayers);
      }

    }




    function sciencePoints() {
      window.clickedInput = document.activeElement;
      console.log(document.activeElement);
      document.getElementById("myModal").style.display = "flex";
      
    }

    function SciencePointsCalc() {
      let nbWheel = Number(document.getElementById("wheel").value);
      let nbCompass = Number(document.getElementById("compass").value);
      let nbTablet = Number(document.getElementById("tablet").value);
      let bonusScore = 0;
      let Score = 0;
      console.log(window.clickedInput)
      for(let nbBonus = 0; nbBonus <= nbWheel && nbBonus <= nbCompass && nbBonus <= nbTablet; nbBonus ++){
        bonusScore = 7 * nbBonus
      }

      Score = nbCompass **2 + nbTablet **2 + nbWheel **2 + bonusScore
      window.clickedInput.value = Score;
      console.log(bonusScore);
      console.log(window.clickedInput.value);
      document.getElementById("myModal").style.display = "none";
    


    }
  </script>

</body>

</html>